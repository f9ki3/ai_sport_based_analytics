<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI-Based Sport Analytics</title>
    {% include "components/header.html" %}
    <style>
      .container {
        min-height: 100vh;
      }
    </style>
  </head>
  <body class="bg-secondary">
    {% include "components/nav_mobile.html" %}

    <div
      style="margin-bottom: 300px"
      class="container d-flex justify-content-center align-items-center flex-column"
    >
    <input type="hidden" id="analytics-data" value='{{ data | tojson }}'>
    <div class="bg-light mt-3 rounded-4 p-4 w-100">
      <div class="mt-4">
          <h2 class="text-center fw-bold">Player 1 Performance</h2>
          <hr />
          <div class="row">
            <div class="col-6">
              <div id="chart-container-player1" class="w-100 mb-4">
                <!-- ApexCharts for Player 1 Smash Strength will render here -->
              </div>
            </div>
            <div class="col-6">
              <p class="text-muted">Average Smash</p>
              <h1 class="fw-bolder player1-smash-avg"></h1>
              <p class="text-muted">Maximum Smash</p>
              <h1 class="fw-bolder player1-smash-max"></h1>
            </div>
            <div class="col-6">
              <div id="chart-container-player1-footwork" class="w-100">
                <!-- ApexCharts for Player 1 Footwork will render here -->
              </div>
            </div>
            <div class="col-6">
              <p>Average Foot Speed</p>
              <h1 class="fw-bolder player1-foot-avg"></h1>
              <p>Maximum Foot Speed</p>
              <h1 class="fw-bolder player1-foot-max"></h1>
            </div>
          </div>
        </div>
      </div>
      <div class="bg-light mt-3 rounded-4 p-4 w-100">
        <div class="mt-4">
          <h2 class="text-center fw-bold">Player 2 Performance</h2>
          <hr />
          <div class="row">
            <div class="col-6">
              <div id="chart-container-player2" class="w-100 mb-4">
                <!-- ApexCharts for Player 2 Smash Strength will render here -->
              </div>
            </div>
            <div class="col-6">
              <p class="text-muted">Average Smash</p>
              <h1 class="fw-bolder player2-smash-avg"></h1>
              <p class="text-muted">Maximum Smash</p>
             <h1 class="fw-bolder player2-smash-max"></h1>
            </div>
            <div class="col-6">
              <div id="chart-container-player2-footwork" class="w-100">
                <!-- ApexCharts for Player 2 Footwork will render here -->
              </div>
            </div>
            <div class="col-6">
              <p>Average Foot Speed</p>
              <h1 class="fw-bolder player2-foot-avg"></h1>
              <p>Maximum Foot Speed</p>
              <h1 class="fw-bolder player2-foot-max"></h1>
            </div>
          </div>
        </div>
      </div>
     <script>
  document.addEventListener("DOMContentLoaded", function () {
    const analyticsData = JSON.parse(document.getElementById("analytics-data").value);
    const stats = analyticsData.stats;
    const processed_video_url = analyticsData.processed_video_url;

    function calculateMaxStrength(average, percentage) {
      return (average / (percentage / 100)).toFixed(2); // max = avg / (avg% / 100)
    }

    // Player 1
    const p1 = stats.Player_1;
    const p1FootworkMaxRaw = calculateMaxStrength(p1.average_footwork, p1.average_footwork_percentage);
    const p1SmashMax = calculateMaxStrength(p1.average_smash_strength, p1.average_smash_strength_percentage);

    // Player 2
    const p2 = stats.Player_2;
    const p2FootworkMaxRaw = calculateMaxStrength(p2.average_footwork, p2.average_footwork_percentage);
    const p2SmashMax = calculateMaxStrength(p2.average_smash_strength, p2.average_smash_strength_percentage);

    // Convert footwork averages and max values to ratio by dividing by 15
    const p1FootworkAvgRatio = (p1.average_footwork / 15).toFixed(2);
    const p1FootworkMaxRatio = (p1FootworkMaxRaw / 15).toFixed(2);

    const p2FootworkAvgRatio = (p2.average_footwork / 15).toFixed(2);
    const p2FootworkMaxRatio = (p2FootworkMaxRaw / 15).toFixed(2);

    // Update DOM text values
    document.querySelectorAll(".player1-smash-avg").forEach(el => el.textContent = `${p1.average_smash_strength} m/s`);
    document.querySelectorAll(".player1-smash-max").forEach(el => el.textContent = `${p1SmashMax} m/s`);
    document.querySelectorAll(".player1-foot-avg").forEach(el => el.textContent = `${p1FootworkAvgRatio} m/s`);
    document.querySelectorAll(".player1-foot-max").forEach(el => el.textContent = `${p1FootworkMaxRatio} m/s`);

    document.querySelectorAll(".player2-smash-avg").forEach(el => el.textContent = `${p2.average_smash_strength} m/s`);
    document.querySelectorAll(".player2-smash-max").forEach(el => el.textContent = `${p2SmashMax} m/s`);
    document.querySelectorAll(".player2-foot-avg").forEach(el => el.textContent = `${p2FootworkAvgRatio} m/s`);
    document.querySelectorAll(".player2-foot-max").forEach(el => el.textContent = `${p2FootworkMaxRatio} m/s`);

   

    // ApexCharts setup
    function createChart(selector, avg, max, labelPrefix, color1, color2) {
      return new ApexCharts(document.querySelector(selector), {
        chart: { type: "donut", height: 350 },
        series: [parseFloat(avg), parseFloat(max)],
        labels: [`${labelPrefix} Avg`, `${labelPrefix} Max`],
        title: {
          text: `${labelPrefix} Metrics`,
          align: "center",
          style: { color: "#6c757d" },
        },
        colors: [color1, color2],
        legend: { show: false },
      });
    }

    createChart("#chart-container-player1", p1.average_smash_strength, p1SmashMax, "Player 1 - Smash", "#007bff", "#add8e6").render();
    createChart("#chart-container-player1-footwork", p1FootworkAvgRatio, p1FootworkMaxRatio, "Player 1 - Foot (Ratio)", "#007bff", "#add8e6").render();
    createChart("#chart-container-player2", p2.average_smash_strength, p2SmashMax, "Player 2 - Smash", "#28a745", "#90ee90").render();
    createChart("#chart-container-player2-footwork", p2FootworkAvgRatio, p2FootworkMaxRatio, "Player 2 - Foot (Ratio)", "#28a745", "#90ee90").render();
  });
</script>


      <div class="bg-light mt-3 rounded-4 p-4 w-100">
        <div class="mb-4">
          <h2 class="text-center fw-bolder mb-3">Video Results</h2>
           <video autoplay muted loop controls class="w-100 rounded-3" id="result-video">
            <source
              src=""
              type="video/mp4"
            />
            Your browser does not support the video tag.
          </video>
          <script>
            document.addEventListener("DOMContentLoaded", function () {
              const analyticsData = JSON.parse(document.getElementById("analytics-data").value);
              const processedVideoUrl = analyticsData.processed_video_url;
              document.querySelector("#result-video source").src = processedVideoUrl;
              document.querySelector("#result-video").load(); // Reload the video with the new source
            });
          </script>
        </div>
        <div class="bg-light mt-3 rounded-4 p-4 w-100">
          <h2 class="text-center fw-bold mb-3">Smash Type Detected</h2>
          <table class="table table-bordered text-center">
            <thead style="background-color: #511ccd; color: white;"></thead>
              <tr>
                <th>Player</th>
                <th>Smash Type</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Player 1</td>
                <td>Forehand Smash</td>
              </tr>
              <tr>
                <td>Player 1</td>
                <td>Backhand Smash</td>
              </tr>
              <tr>
                <td>Player 1</td>
                <td>Jump Smash</td>
              </tr>
              <tr>
                <td>Player 2</td>
                <td>Forehand Smash</td>
              </tr>
              <tr>
                <td>Player 2</td>
                <td>Backhand Smash</td>
              </tr>
              <tr>
                <td>Player 2</td>
                <td>Jump Smash</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    {% include "components/footer.html" %}
  </body>
</html>
